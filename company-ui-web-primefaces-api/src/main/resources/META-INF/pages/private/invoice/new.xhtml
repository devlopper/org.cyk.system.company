<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:cyk="http://xmlns.jcp.org/jsf/composite/org.cyk.ui.web.primefaces/component"
      xmlns:kwordz="http://xmlns.jcp.org/jsf/composite/org.cyk.ui.web.primefaces.kwordz/component">

    <ui:decorate template="#{webPageLayoutManager.decoratedTemplate}">
        <ui:param name="pageController" value="#{invoiceCrudOnePage}" />
        <ui:define name="body">
        	<p:panelGrid columns="8">
        		<p:outputLabel value="#{uiManager.text('model.entity.customer')}" for="customer" />
        		<p:selectOneMenu id="customer" value="#{invoiceCrudOnePage.selectedCustomer}" var="customer"  converter="#{objectConverter}" 
        			filter="true" filterMatchMode="contains">
        			<f:selectItems value="#{invoiceCrudOnePage.customers}" var="c" itemLabel="#{c.person.names}"  />
        			<p:column><h:outputText value="#{customer.registration.code}" /></p:column>
		            <p:column><h:outputText value="#{customer.person.names}" /></p:column>
        		</p:selectOneMenu>
        		
        		<p:outputLabel value="#{uiManager.text('model.entity.service')}" for="service" />
        		<p:selectOneMenu id="service" value="#{invoiceCrudOnePage.selectedService}" var="service" converter="#{objectConverter}" 
        			filter="true" filterMatchMode="contains">
        			<f:selectItems value="#{invoiceCrudOnePage.services}"  />
        			<p:column><h:outputText value="#{service.code}" /></p:column>
		            <p:column><h:outputText value="#{service.name}" /></p:column>
        		</p:selectOneMenu>
        		<p:commandButton value="#{uiManager.text('command.add')}" title="#{uiManager.text('command.add')}" icon="ui-icon-plus" 
        			action="#{invoiceCrudOnePage.addService}" update="datatable" />
				
				<p:outputLabel value="#{uiManager.text('model.entity.serviceCollection')}" for="serviceCollection" />
        		<p:selectOneMenu id="serviceCollection" value="#{invoiceCrudOnePage.selectedServiceCollection}" var="serviceCollection" converter="#{objectConverter}"
        			filter="true" filterMatchMode="contains">
        			<f:selectItems value="#{invoiceCrudOnePage.serviceCollections}"  />
        			<p:column><h:outputText value="#{serviceCollection.code}" /></p:column>
		            <p:column><h:outputText value="#{serviceCollection.name}" /></p:column>
        		</p:selectOneMenu>
        		<p:commandButton value="#{uiManager.text('command.add')}" title="#{uiManager.text('command.add')}" icon="ui-icon-plus" 
        			action="#{invoiceCrudOnePage.addServiceCollection}" update="datatable" />
				
        	</p:panelGrid>
        	
        	<p:dataTable id="datatable" value="#{invoiceCrudOnePage.items}" var="item" rowIndexVar="index" >
        		
        		<p:column headerText="#" width="1%"><h:outputText value="#{index+1}" /></p:column>
        		<p:column headerText="#{uiManager.text('field.code')}" width="7%"><h:outputText value="#{item.code}" /></p:column>
        		<p:column headerText="#{uiManager.text('field.name')}">
        			<ui:fragment rendered="#{item.serviceDeliveryEmployees.size()==1}" >
        				<!--p:panelGrid columns="2">
        					<h:outputText value="#{item.name}" />
        					<p:
        				</p:panelGrid-->
        				EQ1
        			</ui:fragment>
        			<ui:fragment rendered="#{item.serviceDeliveryEmployees.size()>1}" >
        				GT1
        			</ui:fragment>
        			
        			<!--p:fieldset legend="#{uiManager.text('field.deliveredBy')}" >
        				<ui:repeat value="#{item.serviceDeliveryEmployees}" var="serviceDeliveryEmployee">
	        				<p:selectOneMenu id="employee" value="#{serviceDeliveryEmployee.employee}" var="employee" converter="#{objectConverter}" 
			        			filter="true" filterMatchMode="contains">
			        			<f:selectItems value="#{invoiceCrudOnePage.employees}" var="e" itemLabel="#{e.registration.code} - #{e.person.names}" />
			        			<p:column><h:outputText value="#{employee.registration.code}" /></p:column>
					            <p:column><h:outputText value="#{employee.person.names}" /></p:column>
			        		</p:selectOneMenu>
			        		<br/>
	        			</ui:repeat>
	        		</p:fieldset-->
        		</p:column>
        		<p:column headerText="#{uiManager.text('field.price.unit')}" rendered="#{invoiceCrudOnePage.showQuantityColumn}" width="7%">
        			<h:outputText value="#{item.unitPrice}" />
        		</p:column>
        		<p:column headerText="#{uiManager.text('field.quantity')}" rendered="#{invoiceCrudOnePage.showQuantityColumn}" width="4%">
        			<pe:inputNumber value="#{item.quantity}" maxlength="5" required="true" requiredMessage="#{uiManager.text('input.value.required')}" />
        		</p:column>
        		<p:column headerText="#{uiManager.text('field.price.total')}" width="7%">
        			<h:outputText value="#{item.totalPrice}" ></h:outputText>
        			<f:facet name="footer">
        				<h:outputText value="#{invoiceCrudOnePage.totalPrice}" />
        			</f:facet>
        		</p:column>
        		
        		<p:column width="7%"><p:commandButton title="#{uiManager.text('command.delete')}" icon="ui-icon-minus" 
        			action="#{invoiceCrudOnePage.deleteItem(index)}" update="datatable" /></p:column>
        		
        	</p:dataTable>
        	
        </ui:define>
        
        <ui:define name="contentMenuBar">
 			<cyk:command value="#{invoiceCrudOnePage.form.submitCommandable}" executeParameter="#{invoiceCrudOnePage.identifiable}" />
 		</ui:define>
        
    </ui:decorate>
 
</html>
