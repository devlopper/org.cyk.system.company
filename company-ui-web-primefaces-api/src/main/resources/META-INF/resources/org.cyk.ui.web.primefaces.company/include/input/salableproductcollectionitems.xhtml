<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:cyk="http://xmlns.jcp.org/jsf/composite/org.cyk.ui.web.primefaces/component">
    
	<style>
    	.quantityClass input{
        	width: 95%;
        }
	</style>
  
	<p:panelGrid id="optionsPanel" columns="3">
    	<p:outputLabel value="#{uiManager.text('model.entity.product')}" for="salableProduct" />
       	<p:selectOneMenu id="salableProduct" value="#{pageController.itemCollection.oneMasterSelected}" var="salableProduct" converter="#{objectConverter}" 
       		filter="true" filterMatchMode="contains" >
       		<f:selectItems value="#{pageController.salableProducts}" />
       		<p:column><h:outputText value="#{salableProduct.product.code}" /></p:column>
	        <p:column><h:outputText value="#{salableProduct.product.name}" /></p:column>
       	</p:selectOneMenu>
       	<cyk:command value="#{pageController.itemCollection.addCommandable}"/>
	</p:panelGrid>
			
	<p:remoteCommand name="refreshFooter" update=":form:collection:datatable:grandtotal"/>
			
	<cyk:itemCollection id="collection" value="#{pageController.itemCollection}" >
		<p:column headerText="#{uiManager.text('field.code')}" width="7%">
			<h:outputText value="#{item.code}" />
		</p:column>
		<p:column headerText="#{uiManager.text('field.name')}" >
			<h:outputText value="#{item.name}" />
		</p:column>
		<p:column headerText="#{uiManager.text('field.unit.price')}" width="10%">
			<h:outputText value="#{item.unitPrice}" />
		</p:column>
 				
 		<p:column headerText="#{uiManager.text('field.quantity')}" rendered="#{pageController.showQuantityColumn}" width="10%">		
        	<pe:inputNumber id="quantity" value="#{item.quantity}" maxlength="5" required="true" requiredMessage="#{uiManager.text('input.value.required')}" 
        		minValue="1" decimalPlaces="0" styleClass="quantityClass">
        		<p:ajax event="change" listener="#{pageController.productQuantityChanged(item)}" process="quantity" 
        			update="quantifiedPrice,total,@(.#{pageController.form.getInputByFieldName('value').getCss().getUniqueClass()})" 
        			oncomplete="refreshFooter();"/>
        	</pe:inputNumber>
        </p:column>
        		
     	<p:column headerText="#{uiManager.text('field.quantified.price')}" width="10%">
			<h:outputText id="quantifiedPrice" value="#{item.quantifiedPrice}" />
		</p:column>
 				
 		<p:column headerText="#{uiManager.text('field.reduction')}" width="10%">
        	<pe:inputNumber id="reduction" value="#{item.reduction}" maxlength="5"  decimalPlaces="0" styleClass="quantityClass">
        		<p:ajax event="change" listener="#{pageController.productReductionChanged(item)}" process="reduction" 
        			update="total,@(.#{pageController.form.getInputByFieldName('value').getCss().getUniqueClass()})" 
        			oncomplete="refreshFooter();"/>
        	</pe:inputNumber>
        </p:column>
        		
        <p:column headerText="#{uiManager.text('field.price.total')}" width="12%">
        	<h:outputText id="total" value="#{item.totalPrice}" rendered="#{item.identifiable.salableProduct.price!=null}" />
        	<pe:inputNumber id="totalInput" value="#{item.totalPrice}" required="true" requiredMessage="#{item.name} - #{uiManager.textInputValueRequired('field.value')}" 
        		minValue="1" decimalPlaces="0" rendered="#{item.identifiable.salableProduct.price==null}">
        		<p:ajax event="change" listener="#{pageController.productQuantityChanged(item)}" process="totalInput" update="grandtotal" oncomplete="refreshFooter();"/>
        	</pe:inputNumber>
        	<f:facet name="footer">
        		<h:outputText id="grandtotal" value="#{pageController.form.data.cost.value}" />
        	</f:facet>
        </p:column>
        <!--
        <p:column headerText="#{uiManager.text('field.instance')}" rendered="#{pageController.showInstanceColumn}" width="30%">
        	<p:selectOneMenu id="instance" value="#{item.instance}" var="instance" converter="#{objectConverter}" 
	        	filter="true" filterMatchMode="contains" disabled="#{pageController.collectMoney}" >
	        	<f:selectItems value="#{item.instanceChoices}" var="spi" itemLabel="#{spi.code}" />
	        	<p:column><h:outputText value="#{instance.code}" /></p:column>
	        </p:selectOneMenu>
        	<h:outputText value="#{instance.code}" rendered="#{pageController.collectMoney}" />
        </p:column>
        -->
 	</cyk:itemCollection>   
	
</html>
